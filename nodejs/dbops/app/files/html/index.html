<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>API Methods</title>
</head>

<body>
  <hr>
  <h1>API Methods</h1>
  <hr>
  <div id="info">
    <button id="info" onclick="getInfo()">App Info</button>
    <button id="version" onclick="getVersion()">App Version</button>
    <button id="health" onclick="healthCheck()">Health Check</button>
    <button id="orders" onclick="getOrders()">Get Orders</button>
    <button id="stock" onclick="getStock()">Get Stock</button>
    <button id="customers" onclick="getCustomers()">Get Customers</button>
  </div>
  <br><br>
  <h3>Response</h3>
  <div id="response" 
   style="border:solid;font-family:Cursive,Lucida Handwriting;font-size:15px;background-color:#ABBAEA">
  </div>
  <br><br>
  <h3>Error</h3>
  <div id="error" 
   style="border:solid;font-family:Cursive,Lucida Handwriting;font-size:15px;background-color:#f0110a">
  </div>

  <script type="text/javascript">
    async function displayResponse(response) {
      const jsonResponse = await response.json();
      const responseContainer = document.getElementById('response');
      const errorContainer = document.getElementById('error');
      errorContainer.innerText = "";
      responseContainer.innerText = JSON.stringify(jsonResponse, null, 2);
    }

    async function displayError(response) {
      const jsonResponse = await response.json();
      const responseContainer = document.getElementById('response');
      const errorContainer = document.getElementById('error');
      responseContainer.innerText = "";
      errorContainer.innerText = JSON.stringify(jsonResponse, null, 2);
    }

    async function runCmd(cmd) {
      let response = null;
      try {
        const url = window.location.pathname+window.location.search;
        response = await fetch(url+cmd);
        if (response.ok) {
          displayResponse(response);
        } else {
          displayError(response);
        }
      } catch(error) {
        displayError(response);
      }
    }
    // These will only work when deployed with helm
    // Or else change the Helm Ingress definition
    async function getInfo() {
      runCmd('info')
    }


    async function getVersion() {
      runCmd('version')
    }

    async function healthCheck() {
      runCmd('healthz')
    }

    async function getOrders() {
      runCmd('orders')
    }

    async function getStock() {
      runCmd('stock')
    }

    async function getStock() {
      runCmd('customers')
    }
  </script>

</body>

</html>